<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug JSONL Viewer</title>
    <style>
        body { font-family: monospace; margin: 20px; }
        .error { color: red; background: #ffe6e6; padding: 10px; margin: 10px 0; }
        .success { color: green; background: #e6ffe6; padding: 10px; margin: 10px 0; }
        .info { color: blue; background: #e6f3ff; padding: 10px; margin: 10px 0; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; white-space: pre-wrap; }
        input[type="file"] { margin: 20px 0; }
    </style>
</head>
<body>
    <h1>Debug JSONL File Analyzer</h1>
    <input type="file" id="fileInput" accept=".jsonl,.json" onchange="analyzeFile(event)">
    <div id="results"></div>

    <script>
        function analyzeFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const results = document.getElementById('results');
            results.innerHTML = `<div class="info">Analyzing ${file.name} (${(file.size/1024/1024).toFixed(2)} MB)...</div>`;

            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                const lines = text.split('\n');
                
                let log = `File Stats:
- Size: ${text.length} characters
- Lines: ${lines.length}
- Non-empty lines: ${lines.filter(l => l.trim()).length}

Analyzing first 10 lines:
`;

                let validCount = 0;
                let errorCount = 0;
                let sampleData = [];

                for (let i = 0; i < Math.min(10, lines.length); i++) {
                    const line = lines[i].trim();
                    if (!line) continue;

                    try {
                        const data = JSON.parse(line);
                        const hasRequired = data.bucket_type && data.start_time && typeof data.p50_ms === 'number';
                        
                        log += `Line ${i+1}: ${hasRequired ? '✓' : '✗'} `;
                        log += `bucket_type="${data.bucket_type || 'missing'}", `;
                        log += `start_time="${data.start_time || 'missing'}", `;
                        log += `p50_ms=${data.p50_ms} (${typeof data.p50_ms})\\n`;

                        if (hasRequired) {
                            validCount++;
                            if (sampleData.length < 3) {
                                sampleData.push(data);
                            }
                        } else {
                            errorCount++;
                        }
                    } catch (e) {
                        log += `Line ${i+1}: JSON ERROR - ${e.message}\\n`;
                        errorCount++;
                    }
                }

                log += `\\nSummary: ${validCount} valid, ${errorCount} errors\\n`;

                if (sampleData.length > 0) {
                    log += `\\nSample valid data:\\n${JSON.stringify(sampleData[0], null, 2)}\\n`;
                }

                const className = errorCount === 0 ? 'success' : (validCount > 0 ? 'info' : 'error');
                results.innerHTML = `<div class="${className}">Analysis complete</div><div class="log">${log}</div>`;
            };

            reader.onerror = function() {
                results.innerHTML = '<div class="error">Error reading file</div>';
            };

            reader.readAsText(file);
        }
    </script>
</body>
</html>